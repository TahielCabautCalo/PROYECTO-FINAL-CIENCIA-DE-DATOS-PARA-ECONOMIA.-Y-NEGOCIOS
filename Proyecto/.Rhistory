#Para evitar inconvenientes con librerias faltantes
if (!require("pacman")) install.packages("pacman")
pacman::p_load(
readr, dplyr, stringr, readxl, writexl, tidyr, DBI,
lubridate, ggplot2, zoo, quantmod, httr, jsonlite,
lmtest, sandwich, janitor, psych, corrplot, plotly,
tidyverse, fs
)
rm(list=ls())
'%!in%' <- function(x,y)!('%in%'(x,y))
options(scipen = 999)
# Definimos directorios (Rutas relativas)
ruta_raw   <- "data/raw"
ruta_clean <- "data/clean"
# Verificamos que existan los directorios
if(!dir.exists(ruta_clean)) dir.create(ruta_clean, recursive = TRUE)
# 1. Listamos TODOS los archivos .csv en la carpeta
todos_los_archivos <- dir_ls(ruta_raw, glob = "*.csv")
getwd()
# Verificamos que existan los directorios
if(!dir.exists(ruta_clean)) dir.create(ruta_clean, recursive = TRUE)
# 1. Listamos TODOS los archivos .csv en la carpeta
todos_los_archivos <- dir_ls(ruta_raw, glob = "*.csv")
#########################################################
#  TRABAJO FINAL CIENCIA DE DATOS PARA ECON Y NEGOCIOS
#  01. Limpieza de las bases
#########################################################
# --- AUTOCORRECCI√ìN DE DIRECTORIO ---
# Si el usuario abre el script directamente y queda atrapado en la carpeta "scripts",
# esto lo sube autom√°ticamente a la carpeta ra√≠z "Proyecto".
if (basename(getwd()) == "scripts") {
setwd("..")
message("Directorio corregido: Se subi√≥ un nivel hacia la ra√≠z del proyecto.")
}
# Setup -------------------------------------------------------------------
if (!require("pacman")) install.packages("pacman")
pacman::p_load(
readr, dplyr, stringr, readxl, writexl, tidyr, DBI,
lubridate, ggplot2, zoo, quantmod, httr, jsonlite,
lmtest, sandwich, janitor, psych, corrplot, plotly,
tidyverse, fs
)
rm(list=ls())
'%!in%' <- function(x,y)!('%in%'(x,y))
options(scipen = 999)
ruta_raw   <- "data/raw"
ruta_clean <- "data/clean"
# Verificaci√≥n de seguridad visual
print(paste("Buscando datos en:", file.path(getwd(), ruta_raw)))
# 1. Listamos TODOS los archivos .csv en la carpeta
if (!dir.exists(ruta_raw)) {
stop("ERROR CR√çTICO: No se encuentra la carpeta 'data/raw'. Verifica estar en la carpeta ra√≠z 'Proyecto'.")
}
todos_los_archivos <- dir_ls(ruta_raw, glob = "*.csv")
# 2. Separamos la l√≥gica
archivo_precio <- str_subset(todos_los_archivos, "registro-historico")
archivos_molinetes <- todos_los_archivos[todos_los_archivos != archivo_precio]
# --- PROCESO A: PRECIOS ---
precios <- read_csv(archivo_precio) %>%
janitor::clean_names()
rm(list=ls())
# --- BLOQUE DE SEGURIDAD DE RUTAS ---
# 1. Preguntamos: ¬øVeo la carpeta data aqu√≠ mismo? (Caso ideal)
if (dir.exists("data")) {
message("‚úÖ Est√°s en la ra√≠z del proyecto. Todo correcto.")
# 2. Preguntamos: ¬øEst√° la carpeta data un nivel atr√°s? (Caso carpeta scripts)
} else if (dir.exists("../data")) {
setwd("..")
message("‚ö†Ô∏è Estabas en la carpeta 'scripts'. Te he movido a la ra√≠z del proyecto.")
# 3. Si no es ninguno, ERROR.
} else {
stop("‚õî ERROR DE UBICACI√ìN:
R no encuentra la carpeta 'data'.
POR FAVOR: Cierra R, ve a la carpeta de tu proyecto y abre el archivo .Rproj (el cubo azul).")
}
if (!require("pacman")) install.packages("pacman")
pacman::p_load(
readr, dplyr, stringr, readxl, writexl, tidyr, DBI,
lubridate, ggplot2, zoo, quantmod, httr, jsonlite,
lmtest, sandwich, janitor, psych, corrplot, plotly,
tidyverse, fs
)
options(scipen = 999)
# Definimos rutas relativas
ruta_clean <- "data/clean"
ruta_processed <- "data/processed"
# Verificaci√≥n: Chequeamos que exista la data limpia del script 01
if (!file.exists(file.path(ruta_clean, "molinetes_consolidado_2013_2019.rds"))) {
stop("‚ùå ERROR: No encuentro el archivo 'molinetes_consolidado_2013_2019.rds' en data/clean.
¬øCorriste el Script 01?")
}
# Crear carpeta de salida si no existe
if(!dir.exists(ruta_processed)) dir.create(ruta_processed, recursive = TRUE)
# Cargar los datos procesados (.rds)
message("üìÇ Cargando bases...")
if (!require("pacman")) install.packages("pacman")
pacman::p_load(
readr, dplyr, stringr, readxl, writexl, tidyr, DBI,
lubridate, ggplot2, zoo, quantmod, httr, jsonlite,
lmtest, sandwich, janitor, psych, corrplot, plotly,
tidyverse, fs, ggrepel, forecast, scales, knitr
)
rm(list=ls())
'%!in%' <- function(x,y)!('%in%'(x,y))
options(scipen = 999)
ruta_processed <- "data/processed"
ruta_figs      <- "output/figures"
ruta_tablas    <- "output/tables"
# Creamos las carpetas de salida si no existen
if(!dir.exists(ruta_figs)) dir.create(ruta_figs, recursive = TRUE)
if(!dir.exists(ruta_tablas)) dir.create(ruta_tablas, recursive = TRUE)
molinetes_mensual <- read_xlsx(file.path(ruta_processed, "molinetes_mensual.xlsx"))
precios           <- read_xlsx(file.path(ruta_processed, "precios.xlsx"))
# Calculamos l√≠mites y clasificamos
molinetes_mensual <- molinetes_mensual %>%
mutate(anio = year(fecha_eje)) %>%
group_by(anio) %>%
mutate(
Q1 = quantile(total_pasajeros, 0.25, na.rm = TRUE),
Q3 = quantile(total_pasajeros, 0.75, na.rm = TRUE),
IQR = Q3 - Q1,
limite_inferior = Q1 - 1.5 * IQR,
limite_superior = Q3 + 1.5 * IQR
) %>%
ungroup() %>%
mutate(
categoria_outlier = case_when(
total_pasajeros < limite_inferior ~ "Outlier Bajo",
total_pasajeros > limite_superior ~ "Outlier Alto",
TRUE ~ "Normal"
)
)
if (!require("pacman")) install.packages("pacman")
pacman::p_load(
readr, dplyr, stringr, readxl, writexl, tidyr, DBI,
lubridate, ggplot2, zoo, quantmod, httr, jsonlite,
lmtest, sandwich, janitor, psych, corrplot, plotly,
tidyverse, fs, broom
)
rm(list=ls())
'%!in%' <- function(x,y)!('%in%'(x,y))
options(scipen = 999)
ruta_tablas <- "output/tables"
ruta_figs   <- "output/figures"
# Aseguramos que existan las carpetas
if(!dir.exists(ruta_figs)) dir.create(ruta_figs, recursive = TRUE)
if (!require("pacman")) install.packages("pacman")
pacman::p_load(
readr, dplyr, stringr, readxl, writexl, tidyr, DBI,
lubridate, ggplot2, zoo, quantmod, httr, jsonlite,
lmtest, sandwich, janitor, psych, corrplot, plotly,
tidyverse, fs
)
rm(list=ls())
'%!in%' <- function(x,y)!('%in%'(x,y))
options(scipen = 999)
# Definimos directorios (Rutas relativas)
ruta_raw   <- "data/raw"
ruta_clean <- "data/clean"
# Verificaci√≥n de seguridad visual
print(paste("Buscando datos en:", file.path(getwd(), ruta_raw)))
# 1. Listamos TODOS los archivos .csv en la carpeta
if (!dir.exists(ruta_raw)) {
stop("ERROR CR√çTICO: No se encuentra la carpeta 'data/raw'. Verifica estar en la carpeta ra√≠z 'Proyecto'.")
}
todos_los_archivos <- dir_ls(ruta_raw, glob = "*.csv")
# 2. Separamos la l√≥gica
archivo_precio <- str_subset(todos_los_archivos, "registro-historico")
archivos_molinetes <- todos_los_archivos[todos_los_archivos != archivo_precio]
# --- PROCESO A: PRECIOS ---
precios <- read_csv(archivo_precio) %>%
janitor::clean_names()
# --- PROCESO B: MOLINETES ---
print("Procesando molinetes... (Puede demorar unos minutos)")
molinetes <- archivos_molinetes %>%
map_dfr(function(x) {
read_csv(x, col_types = cols(.default = "c")) %>%
janitor::clean_names() %>%
mutate(archivo_origen = path_file(x))
})
