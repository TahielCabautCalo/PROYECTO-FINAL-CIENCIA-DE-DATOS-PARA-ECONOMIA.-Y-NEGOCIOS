#########################################################
#  TRABAJO FINAL CIENCIA DE DATOS PARA ECON Y NEGOCIOS
#  01. Limpieza de las bases
#########################################################
# Setup -------------------------------------------------------------------
# De requerirse, instala las librerias
if (!require("pacman")) install.packages("pacman")
pacman::p_load(
readr, dplyr, stringr, readxl, writexl, tidyr, DBI,
lubridate, ggplot2, zoo, quantmod, httr, jsonlite,
lmtest, sandwich, janitor, psych, corrplot, plotly,
tidyverse, fs
)
rm(list=ls())
'%!in%' <- function(x,y)!('%in%'(x,y))
options(scipen = 999)
# Levantamos y limpiamos las bases ----------------------------------------
# Definimos directorios (Rutas relativas)
ruta_raw <- "../data/raw"
ruta_clean <- "../data/clean"
# Verificación de seguridad visual
print(paste("Buscando datos en:", file.path(getwd(), ruta_raw)))
# 1. Listamos TODOS los archivos .csv en la carpeta
if (!dir.exists(ruta_raw)) {
stop("ERROR CRÍTICO: No se encuentra la carpeta 'data/raw'. Verifica estar en la carpeta raíz 'Proyecto'.")
}
if (!require("pacman")) install.packages("pacman")
pacman::p_load(
readr, dplyr, stringr, readxl, writexl, tidyr, DBI,
lubridate, ggplot2, zoo, quantmod, httr, jsonlite,
lmtest, sandwich, janitor, psych, corrplot, plotly,
tidyverse, fs
)
rm(list=ls())
'%!in%' <- function(x,y)!('%in%'(x,y))
options(scipen = 999)
# Definimos directorios (Rutas relativas)
ruta_raw <- "../data/raw"
ruta_clean <- "../data/clean"
# Verificación de seguridad visual
print(paste("Buscando datos en:", file.path(getwd(), ruta_raw)))
# 1. Listamos TODOS los archivos .csv en la carpeta
if (!dir.exists(ruta_raw)) {
stop("ERROR CRÍTICO: No se encuentra la carpeta 'data/raw'. Verifica estar en la carpeta raíz 'Proyecto'.")
}
if (!require("pacman")) install.packages("pacman")
pacman::p_load(
readr, dplyr, stringr, readxl, writexl, tidyr, DBI,
lubridate, ggplot2, zoo, quantmod, httr, jsonlite,
lmtest, sandwich, janitor, psych, corrplot, plotly,
tidyverse, fs
)
rm(list=ls())
'%!in%' <- function(x,y)!('%in%'(x,y))
options(scipen = 999)
# Levantamos y limpiamos las bases ----------------------------------------
# Definimos directorios (Rutas relativas)
ruta_raw <- "../data/raw"
ruta_clean <- "../data/clean"
# Verificación de seguridad visual
print(paste("Buscando datos en:", file.path(getwd(), ruta_raw)))
# 1. Listamos TODOS los archivos .csv en la carpeta
if (!dir.exists(ruta_raw)) {
stop("ERROR CRÍTICO: No se encuentra la carpeta 'data/raw'. Verifica estar en la carpeta raíz 'Proyecto'.")
}
# Definimos directorios (Rutas relativas)
ruta_raw <- "../data/raw"
print(paste("Buscando datos en:", file.path(getwd(), ruta_raw)))
# 1. Listamos TODOS los archivos .csv en la carpeta
if (!dir.exists(ruta_raw)) {
stop("ERROR CRÍTICO: No se encuentra la carpeta 'data/raw'. Verifica estar en la carpeta raíz 'Proyecto'.")
}
print(paste("Buscando datos en:", file.path(getwd(), ruta_raw)))
# 1. Listamos TODOS los archivos .csv en la carpeta
if (!dir.exists(ruta_raw)) {
stop("ERROR CRÍTICO: No se encuentra la carpeta 'data/raw'. Verifica estar en la carpeta raíz 'Proyecto'.")
}
print(paste("Buscando datos en:", file.path(getwd(), ruta_raw)))
# 1. Listamos TODOS los archivos .csv en la carpeta
if (!dir.exists(ruta_raw)) {
stop("ERROR CRÍTICO: No se encuentra la carpeta 'data/raw'. Verifica estar en la carpeta raíz 'Proyecto'.")
}
print(paste("Buscando datos en:", file.path(getwd(), ruta_raw)))
# 1. Listamos TODOS los archivos .csv en la carpeta
if (!dir.exists(ruta_raw)) {
stop("ERROR CRÍTICO: No se encuentra la carpeta 'data/raw'. Verifica estar en la carpeta raíz 'Proyecto'.")
}
# 2. Separamos la lógica
archivo_precio <- str_subset(todos_los_archivos, "registro-historico")
archivos_molinetes <- todos_los_archivos[todos_los_archivos != archivo_precio]
# --- PROCESO A: PRECIOS ---
precios <- read_csv(archivo_precio) %>%
janitor::clean_names()
# --- PROCESO B: MOLINETES ---
print("Procesando molinetes... (Puede demorar unos minutos)")
molinetes <- archivos_molinetes %>%
map_dfr(function(x) {
read_csv(x, col_types = cols(.default = "c")) %>%
janitor::clean_names() %>%
mutate(archivo_origen = path_file(x))
})
if (!require("pacman")) install.packages("pacman")
pacman::p_load(
readr, dplyr, stringr, readxl, writexl, tidyr, DBI,
lubridate, ggplot2, zoo, quantmod, httr, jsonlite,
lmtest, sandwich, janitor, psych, corrplot, plotly,
tidyverse, fs
)
options(scipen = 999)
# Definimos rutas relativas
ruta_clean <- "../data/clean"
ruta_processed <- "../data/processed"
# Verificación: Chequeamos que exista la data limpia del script 01
if (!file.exists(file.path(ruta_clean, "molinetes_consolidado_2013_2019.rds"))) {
stop("ERROR: No encuentro el archivo 'molinetes_consolidado_2013_2019.rds' en data/clean.
¿Corriste el Script 01?")
}
if (!require("pacman")) install.packages("pacman")
pacman::p_load(
readr, dplyr, stringr, readxl, writexl, tidyr, DBI,
lubridate, ggplot2, zoo, quantmod, httr, jsonlite,
lmtest, sandwich, janitor, psych, corrplot, plotly,
tidyverse, fs
)
rm(list=ls())
'%!in%' <- function(x,y)!('%in%'(x,y))
options(scipen = 999)
if (rstudioapi::isAvailable()) {
ruta_script <- dirname(rstudioapi::getSourceEditorContext()$path)
setwd(ruta_script)
}
# Verificamos dónde quedamos parados (debería ser .../Proyecto/scripts)
print(paste("Trabajando en:", getwd()))
# Definimos directorios (Rutas relativas)
ruta_raw <- "../data/raw"
ruta_clean <- "../data/clean"
# Verificación de seguridad visual
print(paste("Buscando datos en:", file.path(getwd(), ruta_raw)))
# 1. Listamos TODOS los archivos .csv en la carpeta
if (!dir.exists(ruta_raw)) {
stop("ERROR CRÍTICO: No se encuentra la carpeta 'data/raw'. Verifica estar en la carpeta raíz 'Proyecto'.")
}
todos_los_archivos <- dir_ls(ruta_raw, glob = "*.csv")
# 2. Separamos la lógica
archivo_precio <- str_subset(todos_los_archivos, "registro-historico")
archivos_molinetes <- todos_los_archivos[todos_los_archivos != archivo_precio]
# --- PROCESO A: PRECIOS ---
precios <- read_csv(archivo_precio) %>%
janitor::clean_names()
rm(list=ls())
if (!require("pacman")) install.packages("pacman")
pacman::p_load(
readr, dplyr, stringr, readxl, writexl, tidyr, DBI,
lubridate, ggplot2, zoo, quantmod, httr, jsonlite,
lmtest, sandwich, janitor, psych, corrplot, plotly,
tidyverse, fs
)
options(scipen = 999)
if (!require("pacman")) install.packages("pacman")
pacman::p_load(
readr, dplyr, stringr, readxl, writexl, tidyr, DBI,
lubridate, ggplot2, zoo, quantmod, httr, jsonlite,
lmtest, sandwich, janitor, psych, corrplot, plotly,
tidyverse, fs, ggrepel, forecast, scales, knitr
)
rm(list=ls())
'%!in%' <- function(x,y)!('%in%'(x,y))
options(scipen = 999)
if (rstudioapi::isAvailable()) {
ruta_script <- dirname(rstudioapi::getSourceEditorContext()$path)
setwd(ruta_script)
}
# Verificamos dónde quedamos parados (debería ser .../Proyecto/scripts)
print(paste("Trabajando en:", getwd()))
ruta_processed <- "../data/processed"
ruta_figs      <- "../output/figures"
ruta_tablas    <- "../output/tables"
molinetes_mensual <- read_xlsx(file.path(ruta_processed, "molinetes_mensual.xlsx"))
precios           <- read_xlsx(file.path(ruta_processed, "precios.xlsx"))
# Calculamos límites y clasificamos
molinetes_mensual <- molinetes_mensual %>%
mutate(anio = year(fecha_eje)) %>%
group_by(anio) %>%
mutate(
Q1 = quantile(total_pasajeros, 0.25, na.rm = TRUE),
Q3 = quantile(total_pasajeros, 0.75, na.rm = TRUE),
IQR = Q3 - Q1,
limite_inferior = Q1 - 1.5 * IQR,
limite_superior = Q3 + 1.5 * IQR
) %>%
ungroup() %>%
mutate(
categoria_outlier = case_when(
total_pasajeros < limite_inferior ~ "Outlier Bajo",
total_pasajeros > limite_superior ~ "Outlier Alto",
TRUE ~ "Normal"
)
)
molinetes_mensual$categoria_outlier <- factor(molinetes_mensual$categoria_outlier,
levels = c("Outlier Bajo", "Normal", "Outlier Alto"))
# Gráfico 1: Boxplot con Outliers
g1 <- ggplot(molinetes_mensual, aes(x = factor(anio), y = total_pasajeros)) +
geom_boxplot(outlier.shape = NA, color = "gray60", fill = "#E0E0E0", alpha = 0.5) +
geom_point(aes(color = categoria_outlier), size = 3, alpha = 0.8) +
geom_text_repel(
data = filter(molinetes_mensual, categoria_outlier != "Normal"),
aes(label = format(fecha_eje, "%b"), color = categoria_outlier),
size = 3.5, box.padding = 0.5, point.padding = 0.3, force = 10, show.legend = FALSE
) +
scale_color_manual(values = c("Outlier Bajo" = "#D32F2F", "Normal" = "#757575", "Outlier Alto" = "#1976D2")) +
labs(title = "Identificación de Meses Atípicos (Outliers) por Año",
subtitle = "Se etiqueta el mes si cae significativamente fuera del rango normal de SU año.",
x = "Año", y = "Total de Pasajeros", color = "Clasificación del Mes",
caption = "Elaboración propia en base a datos del Gobierno de la Ciudad de Buenos Aires") +
theme_minimal() +
theme(legend.position = "bottom",
plot.title = element_text(size = 22, face = "bold"),
plot.background = element_rect(fill = "white", color = NA))
print(g1)
ggsave(filename = file.path(ruta_figs, "1_outliers_boxplot_anual.png"),
plot = g1, width = 12, height = 8, dpi = 300, bg = "white")
if (!require("pacman")) install.packages("pacman")
pacman::p_load(
readr, dplyr, stringr, readxl, writexl, tidyr, DBI,
lubridate, ggplot2, zoo, quantmod, httr, jsonlite,
lmtest, sandwich, janitor, psych, corrplot, plotly,
tidyverse, fs, broom
)
rm(list=ls())
'%!in%' <- function(x,y)!('%in%'(x,y))
options(scipen = 999)
if (rstudioapi::isAvailable()) {
ruta_script <- dirname(rstudioapi::getSourceEditorContext()$path)
setwd(ruta_script)
}
# Verificamos dónde quedamos parados (debería ser .../Proyecto/scripts)
print(paste("Trabajando en:", getwd()))
ruta_tablas <- "../output/tables"
ruta_figs   <- "../output/figures"
# Aseguramos que existan las carpetas
if(!dir.exists(ruta_figs)) dir.create(ruta_figs, recursive = TRUE)
molinetes_mensual <- read_xlsx(file.path(ruta_tablas, "molinetes_mensual_enriquecida.xlsx"))
precios           <- read_xlsx(file.path(ruta_tablas, "precios_procesado.xlsx"))
datos_regresion <- molinetes_mensual %>%
mutate(
anio_key = as.integer(year(fecha_eje)),
mes_key  = as.integer(month(fecha_eje))
) %>%
inner_join(precios %>%
mutate(anio_key = as.integer(year(fecha)),
mes_key = as.integer(month(fecha))),
by = c("anio_key", "mes_key")) %>%
arrange(fecha_eje) %>%
mutate(
ln_pasajeros = log(total_pasajeros),
ln_precio    = log(precio),
# Variables de Control
tendencia  = row_number(),       # Paso del tiempo (1, 2, 3...)
mes_factor = as.factor(mes_key)  # Mes como categoría (Ene, Feb...)
) %>%
# Limpieza final de infinitos o NAs
filter(is.finite(ln_pasajeros) & is.finite(ln_precio))
if (!require("pacman")) install.packages("pacman")
pacman::p_load(
readr, dplyr, stringr, readxl, writexl, tidyr, DBI,
lubridate, ggplot2, zoo, quantmod, httr, jsonlite,
lmtest, sandwich, janitor, psych, corrplot, plotly,
tidyverse, fs
)
rm(list=ls())
'%!in%' <- function(x,y)!('%in%'(x,y))
options(scipen = 999)
if (rstudioapi::isAvailable()) {
ruta_script <- dirname(rstudioapi::getSourceEditorContext()$path)
setwd(ruta_script)
}
# Verificamos dónde quedamos parados (debería ser .../Proyecto/scripts)
print(paste("Trabajando en:", getwd()))
# Definimos directorios (Rutas relativas)
ruta_raw <- "../data/raw"
ruta_clean <- "../data/clean"
# Verificación de seguridad visual
print(paste("Buscando datos en:", file.path(getwd(), ruta_raw)))
# 1. Listamos TODOS los archivos .csv en la carpeta
if (!dir.exists(ruta_raw)) {
stop("ERROR CRÍTICO: No se encuentra la carpeta 'data/raw'. Verifica estar en la carpeta raíz 'Proyecto'.")
}
todos_los_archivos <- dir_ls(ruta_raw, glob = "*.csv")
# 2. Separamos la lógica
archivo_precio <- str_subset(todos_los_archivos, "registro-historico")
rm(list=ls())
if (!require("pacman")) install.packages("pacman")
pacman::p_load(
readr, dplyr, stringr, readxl, writexl, tidyr, DBI,
lubridate, ggplot2, zoo, quantmod, httr, jsonlite,
lmtest, sandwich, janitor, psych, corrplot, plotly,
tidyverse, fs
)
options(scipen = 999)
if (rstudioapi::isAvailable()) {
ruta_script <- dirname(rstudioapi::getSourceEditorContext()$path)
setwd(ruta_script)
}
# Verificamos dónde quedamos parados (debería ser .../Proyecto/scripts)
print(paste("Trabajando en:", getwd()))
# Definimos rutas relativas
ruta_clean <- "../data/clean"
ruta_processed <- "../data/processed"
# Verificación: Chequeamos que exista la data limpia del script 01
if (!file.exists(file.path(ruta_clean, "molinetes_consolidado_2013_2019.rds"))) {
stop("ERROR: No encuentro el archivo 'molinetes_consolidado_2013_2019.rds' en data/clean.
¿Corriste el Script 01?")
}
# Crear carpeta de salida si no existe
if(!dir.exists(ruta_processed)) dir.create(ruta_processed, recursive = TRUE)
# Cargar los datos procesados (.rds)
molinetes <- read_rds(file.path(ruta_clean, "molinetes_consolidado_2013_2019.rds"))
precios <- read_rds(file.path(ruta_clean, "precio_boleto_historico.rds"))
